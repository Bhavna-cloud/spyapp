version: 0.2

phases:
  install:
    commands:
      # Install Java 17 (Amazon Corretto)
      echo Installing Java 17 Amazon Corretto...
      sudo yum install -y java-17-amazon-corretto-devel || { echo 'Java installation failed'; exit 1; }

      # Set JAVA_HOME and update PATH
      echo Setting JAVA_HOME and PATH...
      export JAVA_HOME=$(dirname $(dirname $(readlink -f $(which java))))
      export PATH=$JAVA_HOME/bin:$PATH
      echo "JAVA_HOME: $JAVA_HOME"
      echo "PATH: $PATH"

      # Verify Java installation
      java -version
      echo JAVA_HOME is set to $JAVA_HOME
      echo PATH is set to $PATH

      # Install Maven 3.9.9
      echo Installing Maven...
      curl -sL https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.9/apache-maven-3.9.9-bin.tar.gz | tar xz -C /tmp || { echo 'Maven installation failed'; exit 1; }
      export M2_HOME=/tmp/apache-maven-3.9.9
      export PATH=$M2_HOME/bin:$PATH

      # Verify Maven installation
      mvn --version || { echo 'Maven verification failed'; exit 1; }

  pre_build:
    commands:
      # Navigate to the spyapp directory where your project is located
      echo Navigating to spyapp directory...
      cd spyapp
      echo Current directory: $(pwd)

  build:
    commands:
      # Compile and package the project using Maven
      echo Compiling the project...
      mvn compile
      echo Packaging the project...
      mvn package -DskipTests=true

  post_build:
    commands:
      # Run the application from the target directory
      echo Running the application...
      cd target/
      java -jar Assignment3_MihyeBang-0.0.1-SNAPSHOT.jar

artifacts:
  files:
    - target/Assignment3_MihyeBang-0.0.1-SNAPSHOT.jar
  discard-paths: yes
